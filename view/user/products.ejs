<%- include('../layouts&partials/user/header.ejs') %>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js" integrity="sha512-pumBsjNRGGqkPzKHndZMaAG+bir374sORyzM3uulLV14lN5LyykqNk8eEeUlUkB3U0M4FApyaHraT65ihJhDpQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.js"
integrity="sha512-zlWWyZq71UMApAjih4WkaRpikgY9Bz1oXIW5G0fED4vk14JjGlQ1UmkGM392jEULP8jbNMiwLWdM8Z87Hu88Fw=="
crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.css"
integrity="sha512-8D+M+7Y6jVsEa7RD6Kv/Z7EImSpNpQllgaEIQAtqHcI0H6F4iZknRj0Nx1DCdB+TwBaS+702BGWYC0Ze2hpExQ=="
crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.js"
integrity="sha512-Y+cHVeYzi7pamIOGBwYHrynWWTKImI9G78i53+azDb1uPmU1Dz9/r2BLxGXWgOC7FhwAGsy3/9YpNYaoBy7Kzg=="
crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.css"
integrity="sha512-wJgJNTBBkLit7ymC6vvzM1EcSWeM9mmOu+1USHaRBbHkm6W9EgM0HY27+UtUaprntaYQJF75rc8gjxllKs5OIQ=="
crossorigin="anonymous" referrerpolicy="no-referrer" />



<!-- Add the JavaScript file before the closing </body> tag of your HTML view file -->
<script src="/node_modules/jquery-toast-plugin/dist/jquery.toast.min.js"></script>

<script src="/node_modules/jquery/dist/jquery.min.js"></script>



    <!--================Home Banner Area =================-->
    <!-- breadcrumb start-->
    <section class="breadcrumb breadcrumb_bg">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="breadcrumb_iner">
                        <div class="breadcrumb_iner_item">
                            <h2>Products</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- breadcrumb start-->

    <!--================Category Product Area =================-->
    <section class="cat_product_area section_padding">
        
        <div class="container">
            <div class="row">
                <div class="col-lg-3">
                    <div class="left_sidebar_area">
                        <aside class="left_widgets p_filter_widgets">

                            <input style="margin-left: 29px;" onkeyup="filtersearch()" id="search" type="text"
                                placeholder="Search Product ">


                            <div class="l_w_title">
                                <h3>Browse Categories</h3>
                            </div>
                            <div class="widgets_inner">
                                <ul class="list">
                                    <% categories.forEach((element)=> { %>
                                        <li>
                                            <label for="">
                                                <%=element.name%>
                                                    <input type="checkbox" onclick="category('<%=element.name%>')"
                                                        name="<%=element.name%>" id="<%=element.name%>"
                                                        value="<%=element.name%>">

                                            </label>

                                        </li>
                                        <% }); %>
                                </ul>
                            </div>

                        </aside>

                       

                    </aside>

                    <aside>

                        

                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="shop__product__option__right">
                                <p>Sort by Price:</p>
                                <select onchange="sortProducts()">>
                                    <option value="LtoH" id="low">Low To High</option>
                                    <option value="HtoL" id="high">High To Low</option>

                                </select>

                            </div>
                        </div>
                        

                    </aside>

                    <aside class="left_widgets p_filter_widgets">
                        <!-- <br>
                        <br>
                        <div class="l_w_title">
                            <h3>Price Filter</h3>
                        </div> -->
                        <!-- <div class="widgets_inner">
                            <ul class="list">
                                <ul class="list">
                                    <li>
                                        <label for="">
                                            40000-above
                                            <input onclick="price(4)" type="checkbox" value="40000" id="FOUR">
                                        </label><br>
                                    </li>
                                    <li>
                                        <label for="">
                                            30000-20000
                                            <input onclick="price(3)" type="checkbox" value="30000,300000" id="THREE">
                                        </label><br>
                                    </li>
                                    <li class="active">
                                        <label for="">
                                            50000-100000
                                            <input onclick="price(2)" type="checkbox" value="50000,100000" id="TWO">
                                        </label><br>
                                    </li>
                                    <li>
                                        <label for="">
                                            10000-50000
                                            <input onclick="price(1)" type="checkbox" value="10000,50000" id="ONE">
                                        </label><br>
                                    </li>

                                </ul>
                        </div> -->
                    </aside>

                        
                    </div>
                </div>
                <div class="col-lg-9">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="product_top_bar d-flex justify-content-between align-items-center">
                                <div class="single_product_menu">
                                   
                                        <!-- <% if(productData.length>1){ %>
                                            <p><span><%= productData.length %> </span>Products Found</p>
                                      <%  }else{ %>
                                        <p><span><%= productData.length %> </span>Product Found</p>

                                    <%  } %> -->


                                </div>
                               
                                <nav aria-label="Page navigation example">
                                    <ul class="pagination">
                                      <li class="page-item">

                                       
                                        
                                      </li>
                                      <% for(let i=1; i<=pages; i++ ){ %>
                                      <li class="page-item"><a class="page-link" href="/products?page=<%= i %>"><%= i %></a></li>
                                      <% } %>
                                      <li class="page-item">

                                        

                                      </li>
                                    </ul>
                                  </nav>

                                <!-- <div class="single_product_menu d-flex">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="search"
                                            aria-describedby="inputGroupPrepend">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text" id="inputGroupPrepend"><i
                                                    class="ti-search"></i></span>
                                        </div>
                                    </div>
                                </div> -->

                            </div>
                        </div>
                    </div>
                    

                    
                    <div class="row align-items-center latest_product_inner" id="Filter">
                        
                        
                    <% for(products of productData){ %>

                        <div class="col-lg-4 col-sm-6" >
                            <div class="single_product_item">
                              <a href="/singleProduct/<%= products._id %>" style="text-decoration: none;"> <img src="<%= products.image[0] %>" alt=""> </a>
                              <a href="/singleProduct/<%= products._id %>" style="text-decoration: none;font-weight: bold;">  <h4 style="font-weight: 900;"> <%= products.name %> </h4>  </a>
                              <h3 style="font-family: math;line-height: 2.2em;">&#8377;<%= products.price %> </h3>

                                <div class="single_product_text">

                                    <a onclick="addToWishlist ('<%= products._id %>')"  style="color: dodgerblue; cursor: pointer;" class="add_cart">+ add to wishlist </a>
                                    <a onclick="addToCart ('<%= products._id %>')"  style="color: rgb(253, 1, 1); cursor: pointer;" class="add_cart">+ add to cart </a>


                                </div>

                            </div>
                        </div>
                        
                    <% } %>
                </div>


                </div>
            </div>
        </div>
    </section>
    <!--================End Category Product Area =================-->

    <!-- product_list part start-->
    <section class="product_list best_seller">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-12">
                    <div class="section_tittle text-center">
                        <h2>Best Sellers <span>shop</span></h2>
                    </div>
                </div>
            </div>
            <div class="row align-items-center justify-content-between">
                <div class="col-lg-12">
                    <div class="best_product_slider owl-carousel">

                        <% for(products of productData2){ %>

                        <div class="single_product_item">
                            <img src="<%= products.image[0] %>" alt="">
                            <div class="single_product_text">
                                <h4><%= products.name %></h4>
                                <h3>$<%= products.price %></h3>
                            </div>
                        </div>
                       
                        <% } %>

                    </div>
                </div>
            </div>
        </div>
    </section>
   

    <!-- product_list part end-->

        <script>
            let n = 0
            let b = 0
            let categorys = []
            let search
            let sort
            let prices = []
            let filterprice = []
            function category(ID) {
                hidePagination()


                if ($(`#${ID}`).is(':checked') == true) {
                    categorys[n] = $(`#${ID}`).val()
                    n++
                    console.log(categorys);
                    console.log($(`#${ID}`).is(':checked'))
                } else {
                    console.log($(`#${ID}`).is(':checked'))
                    console.log(categorys.indexOf(`${$(`#${ID}`).val()}`));
                    let index = categorys.indexOf(`${$(`#${ID}`).val()}`)
                    categorys.splice(index, 1)
                    n--
                    console.log(categorys);
                }
                submit(categorys, filterprice, search ,sort)

            }


            function submit(categorys, filterprice, search ,sort) {
                hidePagination()

                $.ajax({
                    url: '/shopFilter',
                    type: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify({ categorys, filterprice, search ,sort }),
                    success: (res) => {
                        let html = []
                        if (res.Data) {
                            console.log(res.Data);
                            $('#Filter').html('')
                            res.Data.forEach(value => {
                                value.forEach((item, i) => {
                                    
                                    html += `<a href="/singleProduct/${item._id}"> <div class="col-lg-4 col-sm-6" >
                                        
                                <div class="single_product_item">
                            
                                <img src="/adminassets/images/${item.image[0]}" alt="">

                                <h4>${item.name}</h4>
                                <h3>$${item.price}</h3>

                                <div class="single_product_text">


                                    
                                </a>
                            <a style="color: dodgerblue;" href="/addtoWishlist/${item._id}" class="add_cart">+ add to wishlist </a>
                            <a style="color: rgb(253, 1, 1);" href="/addtoCart/${item._id}" class="add_cart">+ add to cart  </a>

                            </div>
                            </div> 
                        
                    </div> `

                                })

                            });

                            $('#Filter').html(html)




                        }
                    }
                })
            }

        

            function filtersearch() {
                hidePagination()

                search = $('#search').val()
                submit(categorys,   filterprice, search ,sort)
            }


            function price(check) {
                filterprice = []
                let one, two, three, fore
                let n = 0, index
                if ($("#ONE").is(':checked') == true) {
                    one = $("#ONE").val()
                    prices[n] = one
                    n++
                } else if (check == 1) {
                    index = prices.indexOf($("#ONE").val())
                    prices.splice(index, 1)

                }
                if ($("#TWO").is(':checked') == true) {
                    two = $("#TWO").val()
                    prices[n] = two
                    n++
                } else if (check == 2) {
                    index = prices.indexOf($("#TWO").val())
                    prices.splice(index, 1)

                }
                if ($("#THREE").is(':checked') == true) {
                    three = $("#THREE").val()
                    prices[n] = three
                    n++
                } else if (check == 3) {
                    index = prices.indexOf($("#THREE").val())
                    prices.splice(index, 1)

                }
                if ($("#FOUR").is(':checked') == true) {
                    fore = $("#FOUR").val()
                    prices[n] = fore
                    n++
                } else if (check == 4) {
                    index = prices.indexOf($("#FOUR").val())
                    prices.splice(index, 1)

                }
                let length
                if (prices) {
                    length = prices.length
                }


                if (prices.length == 1 && prices[length - 1].split(',').length == 2) {
                    let first = [prices[length - 1]]
                    first = first[0].split(',')

                    filterprice[0] = first[0]
                    filterprice[1] = first[1]

                } else if (prices.length == 1 && prices[length - 1].split(',').length == 1) {
                    console.log('50000');
                    let first = []
                    first[0] = prices[0]
                    filterprice[0] = first[0]
                    console.log(filterprice);
                } else if (prices.length > 1 && prices[length - 1].split(',').length == 2) {
                    let first = [prices[0]]
                    let second = [prices[length - 1]]
                    first = first[0].split(',')
                    second = second[0].split(',')
                    filterprice[0] = first[0]
                    filterprice[1] = second[1]
                    console.log(filterprice);
                } else if (prices.length > 1 && prices[length - 1].split(',').length == 1) {
                    let first = [prices[0]]
                    first = first[0].split(',')
                    filterprice[0] = first[0]
                    console.log(filterprice);
                    console.log('dhcf');
                }
                submit(categorys,filterprice, search ,sort)
            }

            function sortProducts() {
                hidePagination()
                        let selectedSort = document.querySelector('select').value;
                        if (selectedSort === 'LtoH') {
                            sort = 'priceLowToHigh';
                        } else if (selectedSort === 'HtoL') {
                            sort = 'priceHighToLow';
                        }
                        submit( categorys,filterprice, search ,sort);
                    }
                    function hidePagination() {
  const pagination = document.querySelector('.pagination');
  pagination.style.display = 'none';
}


        </script>




<script>

    function addToCart(proId) {
        $.ajax({
            url: '/addToCart/' + proId,
            method: 'get',
            success: (response) => {
                if (response.message === "Product already in cart") {
                    console.log(response.message);
                    Swal.fire({
                        position: 'top-end',
                        icon: 'error',
                        title: 'Product already in cart',
                        showConfirmButton: false,
                        timer: 1500
                    })
                } else if (response.message === "Product added to cart") {
                    console.log(response.message);
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        title: 'Product added to cart',
                        showConfirmButton: false,
                        timer: 1500
                    })
                } else if (response.message === "hello") {
                    console.log(response.message);
                    location.href = '/login'

                    // Handle other response messages
                } else if (response.message === "Product is out of stock") {
                    Swal.fire({
                        position: 'top-middle',

                        title: 'product is out of stock',
                        showConfirmButton: false,
                        timer: 1500
                    })

                }
            },
            error: (error) => {
                // Handle errors
            }
        });

    }



    function addToWishlist(proId) {
        $.ajax({
            url: '/addToWishlist/' + proId,
            method: 'get',
            success: (response) => {
                if (response.message === "Product already in wishlist") {
                    Swal.fire({
                        position: 'top-end',
                        icon: 'error',
                        title: 'Product already in wishlist',
                        showConfirmButton: false,
                        timer: 1500
                    })
                } else if (response.message === "Product added to wishlist") {
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        title: 'Product added to wishlist',
                        showConfirmButton: false,
                        timer: 1500
                    })
                } else if (response.message === "hello") {
                    location.href = '/login'
                    // Handle other response messages
                }
            },
            error: (error) => {
                // Handle errors
            }
        });

    }



</script>



    <%- include('../layouts&partials/user/footer.ejs') %>

  